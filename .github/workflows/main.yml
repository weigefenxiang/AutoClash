name: AutoClash

on: [push]

jobs:
  job1:
    runs-on: ubuntu-latest
    env:
      TZ: Asia/Shanghai
      
    timeout-minutes: 10
    steps:
    - uses: actions/checkout@v3
    - run: docker build -t ubuntu/clash:0.1 docker/.
    - run: docker images
    - run: docker ps -a
    - name: Login
      uses: docker/login-action@v1
      with:
          username: "${{ secrets.REGISTRY_USERNAME }}"
          password: "${{ secrets.REGISTRY_PASSWORD }}"
    - name: Build && Push
      uses: docker/build-push-action@v3
      with:
          context: .
          file: docker/Dockerfile
          push: true
          tags: |
            ${{ env.REGISTRY }}/${{ github.repository_owner }}/${{ env.IMAGE_NAME }}:${{ needs.get-tags.outputs.tags }}
            ${{ env.REGISTRY }}/${{ github.repository_owner }}/${{ env.IMAGE_NAME }}:latest     
    





